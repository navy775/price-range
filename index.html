<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>股票損益試算器</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Noto Sans TC', sans-serif; }
    .tab-active { background-color: #2563eb; color: white; }
    .tab-inactive { background-color: #e0e7ff; color: #1e40af; }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-blue-100 min-h-screen p-4">
  <div class="max-w-5xl mx-auto bg-white shadow-xl rounded-xl p-6">
    <h1 class="text-3xl font-bold text-center text-blue-800 mb-6">股票損益試算器</h1>

    <!-- 分頁按鈕 -->
    <div class="flex justify-center space-x-4 mb-6">
      <button onclick="switchTab('dayTrade')" id="tab-dayTrade" class="px-4 py-2 rounded tab-active">當沖</button>
      <button onclick="switchTab('stock')" id="tab-stock" class="px-4 py-2 rounded tab-inactive">個股</button>
      <button onclick="switchTab('warrant')" id="tab-warrant" class="px-4 py-2 rounded tab-inactive">權證</button>
    </div>

    <!-- 當沖表單 -->
    <div id="dayTrade" class="tab-content">
      <form id="form-dayTrade">
        <!-- 表單內容 -->
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 mb-4">
          <inputBox label="買入價格" id="buyPrice-dayTrade" value="100" />
          <inputBox label="股數" id="shares-dayTrade" value="1000" />
          <inputBox label="手續費折數" id="feeRate-dayTrade" value="5" />
          <inputBox label="最低手續費（元）" id="minFee-dayTrade" value="20" />
          <inputBox label="交易稅率（%）" id="taxRate-dayTrade" value="0.15" />
          <selectBox label="交易方向" id="direction-dayTrade" />
        </div>
        <button class="btn-main" type="button" onclick="resetAndCalculate('dayTrade')">開始試算</button>
      </form>
      <moreButtons tab="dayTrade" />
      <resultTable id="dayTrade" />
    </div>

    <!-- 個股表單 -->
    <div id="stock" class="tab-content hidden">
      <form id="form-stock">
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 mb-4">
          <inputBox label="買入價格" id="buyPrice-stock" value="100" />
          <inputBox label="股數" id="shares-stock" value="1000" />
          <inputBox label="手續費折數" id="feeRate-stock" value="10" />
          <inputBox label="最低手續費（元）" id="minFee-stock" value="1" />
          <inputBox label="交易稅率（%）" id="taxRate-stock" value="0.3" />
          <selectBox label="交易方向" id="direction-stock" />
        </div>
        <button class="btn-main" type="button" onclick="resetAndCalculate('stock')">開始試算</button>
      </form>
      <moreButtons tab="stock" />
      <resultTable id="stock" />
    </div>

    <!-- 權證表單 -->
    <div id="warrant" class="tab-content hidden">
      <form id="form-warrant">
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 mb-4">
          <inputBox label="買入價格" id="buyPrice-warrant" value="1.5" />
          <inputBox label="股數" id="shares-warrant" value="10000" />
          <inputBox label="手續費折數" id="feeRate-warrant" value="5" />
          <inputBox label="最低手續費（元）" id="minFee-warrant" value="0" />
          <inputBox label="交易稅率（%）" id="taxRate-warrant" value="0" />
          <selectBox label="交易方向" id="direction-warrant" />
        </div>
        <button class="btn-main" type="button" onclick="resetAndCalculate('warrant')">開始試算</button>
      </form>
      <moreButtons tab="warrant" />
      <resultTable id="warrant" />
    </div>
  </div>

  <script>
    const tabIds = ['dayTrade', 'stock', 'warrant'];
    const stepsMap = { dayTrade: 10, stock: 10, warrant: 10 };

    function switchTab(tab) {
      tabIds.forEach(id => {
        document.getElementById(id).classList.toggle('hidden', id !== tab);
        document.getElementById('tab-' + id).className = (id === tab ? 'tab-active' : 'tab-inactive') + " px-4 py-2 rounded";
      });
    }

    function getTickSize(price) {
      if (price < 10) return 0.01;
      if (price < 50) return 0.05;
      if (price < 100) return 0.1;
      if (price < 500) return 0.5;
      if (price < 1000) return 1;
      return 5;
    }

    function resetAndCalculate(tab) {
      stepsMap[tab] = 10;
      calculate(tab);
    }

    function showMore(tab, direction) {
      stepsMap[tab] += 5;
      calculate(tab);
    }

    function calculate(tab) {
      const buy = parseFloat(document.getElementById(`buyPrice-${tab}`).value);
      const shares = parseInt(document.getElementById(`shares-${tab}`).value);
      const feeRate = parseFloat(document.getElementById(`feeRate-${tab}`).value) / 10;
      const minFee = parseFloat(document.getElementById(`minFee-${tab}`).value);
      const taxRate = parseFloat(document.getElementById(`taxRate-${tab}`).value) / 100;
      const direction = document.getElementById(`direction-${tab}`).value;
      const tick = getTickSize(buy);
      const resultTable = document.getElementById(`resultTable-${tab}`);
      resultTable.innerHTML = '';
      let prices = [];
      for (let i = -stepsMap[tab]; i <= stepsMap[tab]; i++) {
        let sell = +(buy + i * tick).toFixed(2);
        if (direction === 'short') sell = +(buy - i * tick).toFixed(2);
        prices.push(sell);
      }
      if (direction === 'long') prices.reverse();

      for (let sell of prices) {
        const totalBuy = buy * shares;
        const totalSell = sell * shares;
        const tax = Math.floor(totalSell * taxRate);
        const fee = Math.max(minFee, Math.floor((totalBuy + totalSell) * 0.001425 * feeRate));
        const profit = direction === 'long'
          ? (totalSell - totalBuy - tax - fee)
          : (totalBuy - totalSell - tax - fee);
        const returnRate = (profit / totalBuy * 100).toFixed(2);
        const row = document.createElement('tr');
        row.innerHTML = `
          <td class="p-2">${buy}</td>
          <td class="p-2">${sell}</td>
          <td class="p-2">${tax}</td>
          <td class="p-2">${fee}</td>
          <td class="p-2 ${profit >= 0 ? 'text-green-600' : 'text-red-600'}">${profit}</td>
          <td class="p-2 ${profit >= 0 ? 'text-green-600' : 'text-red-600'}">${returnRate}%</td>`;
        resultTable.appendChild(row);
      }
    }

    // HTML helper functions
    function inputBox({ label, id, value }) {
      document.write(`<div><label class="block font-semibold text-gray-700 mb-1">${label}</label><input type="number" id="${id}" class="w-full border rounded p-3" value="${value}"></div>`);
    }

    function selectBox({ label, id }) {
      document.write(`<div><label class="block font-semibold text-gray-700 mb-1">${label}</label><select id="${id}" class="w-full border rounded p-3"><option value="long">作多</option><option value="short">作空</option></select></div>`);
    }

    function moreButtons({ tab }) {
      document.write(`
        <div class="flex justify-center gap-4 mt-6">
          <button onclick="showMore('${tab}', 'up')" class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded">顯示更高價格</button>
          <button onclick="showMore('${tab}', 'down')" class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded">顯示更低價格</button>
        </div>`);
    }

    function resultTable({ id }) {
      document.write(`
        <div class="mt-6 overflow-x-auto">
          <table class="min-w-full text-center border border-gray-300 rounded-xl">
            <thead class="bg-blue-200 text-blue-800 text-sm sm:text-base">
              <tr>
                <th class="p-2">買入價</th>
                <th class="p-2">賣出價</th>
                <th class="p-2">交易稅</th>
                <th class="p-2">手續費</th>
                <th class="p-2">損益</th>
                <th class="p-2">報酬率</th>
              </tr>
            </thead>
            <tbody id="resultTable-${id}" class="bg-white text-sm sm:text-base"></tbody>
          </table>
        </div>`);
    }
  </script>
</body>
</html>
