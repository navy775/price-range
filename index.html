<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>損益試算器</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Noto Sans TC', sans-serif; }
    .tab-button.active { @apply bg-blue-600 text-white; }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-blue-100 min-h-screen p-4 sm:p-6">
  <div class="max-w-5xl mx-auto bg-white shadow-2xl rounded-2xl p-4 sm:p-6">
    <h1 class="text-3xl font-bold text-center text-blue-800 mb-4">損益試算器</h1>

    <!-- Tabs -->
    <div class="flex justify-center mb-6">
      <button onclick="switchTab('daytrade')" id="tab-daytrade" class="tab-button px-4 py-2 border rounded-l active">當沖</button>
      <button onclick="switchTab('stock')" id="tab-stock" class="tab-button px-4 py-2 border-t border-b border-r rounded-r">個股</button>
    </div>

    <!-- Tab: Day Trade -->
    <div id="content-daytrade">
      <!-- 原本的當沖損益試算器（略） -->
      <p class="text-center text-gray-500 mb-6">（這裡會顯示你的當沖試算器內容）</p>
    </div>

    <!-- Tab: Stock -->
    <div id="content-stock" class="hidden">
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-8">
        <div>
          <label class="block font-semibold mb-1">買入價格</label>
          <input type="number" id="stockBuyPrice" class="w-full border rounded p-3" value="100">
        </div>
        <div>
          <label class="block font-semibold mb-1">股數</label>
          <input type="number" id="stockShares" class="w-full border rounded p-3" value="1000">
        </div>
        <div>
          <label class="block font-semibold mb-1">手續費折數</label>
          <input type="number" id="stockFeeRate" class="w-full border rounded p-3" value="5">
        </div>
        <div>
          <label class="block font-semibold mb-1">最低手續費（元）</label>
          <input type="number" id="stockMinFee" class="w-full border rounded p-3" value="20">
        </div>
        <div>
          <label class="block font-semibold mb-1">交易稅率（%）</label>
          <input type="number" id="stockTaxRate" class="w-full border rounded p-3" value="0.3">
        </div>
      </div>
      <div class="text-center">
        <button onclick="calculateStock()" class="bg-blue-600 text-white px-6 py-3 rounded hover:bg-blue-700">開始試算</button>
      </div>
      <div class="mt-8 overflow-x-auto">
        <table class="min-w-full text-center border border-gray-300 rounded-xl">
          <thead class="bg-blue-200 text-blue-800 text-sm sm:text-base">
            <tr>
              <th class="p-2">買入價</th>
              <th class="p-2">賣出價</th>
              <th class="p-2">交易稅</th>
              <th class="p-2">手續費</th>
              <th class="p-2">損益</th>
              <th class="p-2">報酬率</th>
            </tr>
          </thead>
          <tbody id="stockResultTable" class="bg-white text-sm sm:text-base"></tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    function switchTab(tab) {
      document.getElementById('content-daytrade').classList.add('hidden');
      document.getElementById('content-stock').classList.add('hidden');
      document.getElementById('tab-daytrade').classList.remove('active');
      document.getElementById('tab-stock').classList.remove('active');

      document.getElementById(`content-${tab}`).classList.remove('hidden');
      document.getElementById(`tab-${tab}`).classList.add('active');
    }

    function calculateStock() {
      const buy = parseFloat(document.getElementById('stockBuyPrice').value);
      const shares = parseInt(document.getElementById('stockShares').value);
      const feeRate = parseFloat(document.getElementById('stockFeeRate').value) / 10;
      const minFee = parseFloat(document.getElementById('stockMinFee').value);
      const taxRate = parseFloat(document.getElementById('stockTaxRate').value) / 100;
      const resultTable = document.getElementById('stockResultTable');
      resultTable.innerHTML = '';

      function getTick(price) {
        if (price < 10) return 0.01;
        if (price < 50) return 0.05;
        if (price < 100) return 0.1;
        if (price < 500) return 0.5;
        if (price < 1000) return 1;
        return 5;
      }

      const tick = getTick(buy);
      for (let i = -10; i <= 10; i++) {
        let sell = +(buy + i * tick).toFixed(2);
        const totalBuy = buy * shares;
        const totalSell = sell * shares;

        const fee = Math.max(minFee, Math.floor((totalBuy + totalSell) * 0.001425 * feeRate));
        const tax = Math.floor(totalSell * taxRate);
        const profit = totalSell - totalBuy - tax - fee;
        const rate = (profit / totalBuy * 100).toFixed(2);

        const row = document.createElement('tr');
        row.innerHTML = `
          <td class="p-2">${buy}</td>
          <td class="p-2">${sell}</td>
          <td class="p-2">${tax}</td>
          <td class="p-2">${fee}</td>
          <td class="p-2 ${profit >= 0 ? 'text-green-600' : 'text-red-600'}">${profit}</td>
          <td class="p-2 ${profit >= 0 ? 'text-green-600' : 'text-red-600'}">${rate}%</td>
        `;
        resultTable.appendChild(row);
      }
    }
  </script>
</body>
</html>
