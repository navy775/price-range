<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å¤šåŠŸèƒ½è‚¡ç¥¨è©¦ç®—å·¥å…·</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .tab-button {
      @apply px-4 py-2 font-bold rounded-t-lg border-b-4 border-transparent hover:bg-blue-100 transition-all;
    }
    .tab-button.active {
      @apply text-blue-700 border-blue-500 bg-blue-100;
    }
  </style>
</head>
<body class="bg-blue-50 min-h-screen text-gray-800">
  <div class="max-w-6xl mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold text-center text-blue-800 mb-8">ğŸ“Š å¤šåŠŸèƒ½è‚¡ç¥¨è©¦ç®—å·¥å…·</h1>

    <!-- Tabs -->
    <div class="flex justify-center space-x-2 border-b pb-2 mb-4">
      <button class="tab-button active" onclick="switchTab('intraday')">ç•¶æ²–</button>
      <button class="tab-button" onclick="switchTab('stock')">å€‹è‚¡</button>
      <button class="tab-button" onclick="switchTab('warrant')">æ¬Šè­‰</button>
      <button class="tab-button" onclick="switchTab('odd')">é›¶è‚¡</button>
    </div>

    <!-- Tab Content -->
    <div id="intraday" class="tab-content"></div>
    <div id="stock" class="tab-content hidden"></div>
    <div id="warrant" class="tab-content hidden"></div>
    <div id="odd" class="tab-content hidden"></div>
  </div>

  <script>
    const tabs = ["intraday", "stock", "warrant", "odd"];
    const currentSteps = { intraday: 10, stock: 10, warrant: 10, odd: 10 };

    function switchTab(tabId) {
      tabs.forEach(id => {
        document.getElementById(id).classList.add("hidden");
        const btn = document.querySelector(`.tab-button[onclick="switchTab('${id}')"]`);
        btn.classList.remove("active");
      });
      document.getElementById(tabId).classList.remove("hidden");
      const activeBtn = document.querySelector(`.tab-button[onclick="switchTab('${tabId}')"]`);
      activeBtn.classList.add("active");

      if (!document.getElementById(tabId).hasChildNodes()) renderCalculator(tabId);
    }

    function getTickSize(price) {
      if (price < 10) return 0.01;
      if (price < 50) return 0.05;
      if (price < 100) return 0.1;
      if (price < 500) return 0.5;
      if (price < 1000) return 1;
      return 5;
    }

    function renderCalculator(type) {
      const taxDefault = type === "warrant" ? 0.1 : type === "intraday" ? 0.15 : 0.3;
      const container = document.getElementById(type);
      container.innerHTML = `
        <div class="grid md:grid-cols-3 sm:grid-cols-2 gap-4 mb-6">
          <div><label>è²·å…¥åƒ¹æ ¼</label><input type="number" id="${type}_buy" class="w-full border p-2" value="100" /></div>
          <div><label>è‚¡æ•¸</label><input type="number" id="${type}_shares" class="w-full border p-2" value="1000" /></div>
          <div><label>æ‰‹çºŒè²»æŠ˜æ•¸ï¼ˆè¼¸å…¥ 5 ä»£è¡¨äº”æŠ˜ï¼‰</label><input type="number" id="${type}_fee" class="w-full border p-2" value="5" /></div>
          <div><label>æœ€ä½æ‰‹çºŒè²»</label><input type="number" id="${type}_min" class="w-full border p-2" value="20" /></div>
          <div><label>äº¤æ˜“ç¨…ç‡ï¼ˆ%ï¼‰</label><input type="number" id="${type}_tax" class="w-full border p-2" value="${taxDefault}" /></div>
          <div><label>äº¤æ˜“æ–¹å‘</label>
            <select id="${type}_dir" class="w-full border p-2">
              <option value="long">ä½œå¤š</option>
              <option value="short">ä½œç©º</option>
            </select>
          </div>
        </div>

        <div class="text-center mb-4">
          <button onclick="resetCalc('${type}')" class="bg-blue-600 text-white px-6 py-2 rounded shadow hover:bg-blue-700">é–‹å§‹è©¦ç®—</button>
        </div>

        <div class="flex justify-center gap-4 mb-4">
          <button onclick="showMore('${type}', 'up')" class="bg-gray-200 hover:bg-gray-300 px-4 py-2 rounded">é¡¯ç¤ºæ›´é«˜åƒ¹æ ¼</button>
          <button onclick="showMore('${type}', 'down')" class="bg-gray-200 hover:bg-gray-300 px-4 py-2 rounded">é¡¯ç¤ºæ›´ä½åƒ¹æ ¼</button>
        </div>

        <div class="overflow-x-auto">
          <table class="min-w-full border text-center bg-white">
            <thead class="bg-blue-100 text-sm">
              <tr>
                <th class="p-2">è²·å…¥åƒ¹</th>
                <th class="p-2">è³£å‡ºåƒ¹</th>
                <th class="p-2">äº¤æ˜“ç¨…</th>
                <th class="p-2">æ‰‹çºŒè²»</th>
                <th class="p-2">æç›Š</th>
                <th class="p-2">å ±é…¬ç‡</th>
              </tr>
            </thead>
            <tbody id="${type}_result" class="text-sm"></tbody>
          </table>
        </div>
      `;
      calculate(type);
    }

    function resetCalc(type) {
      currentSteps[type] = 10;
      calculate(type);
    }

    function showMore(type, direction) {
      currentSteps[type] += 5;
      calculate(type);
    }

    function calculate(type) {
      const buy = parseFloat(document.getElementById(`${type}_buy`).value);
      const shares = parseInt(document.getElementById(`${type}_shares`).value);
      const feeRate = parseFloat(document.getElementById(`${type}_fee`).value) / 10;
      const minFee = parseFloat(document.getElementById(`${type}_min`).value);
      const taxRate = parseFloat(document.getElementById(`${type}_tax`).value) / 100;
      const direction = document.getElementById(`${type}_dir`).value;
      const tick = getTickSize(buy);

      const result = document.getElementById(`${type}_result`);
      result.innerHTML = '';

      let priceSteps = [];
      for (let i = -currentSteps[type]; i <= currentSteps[type]; i++) {
        let sell = +(buy + i * tick).toFixed(2);
        if (direction === 'short') sell = +(buy - i * tick).toFixed(2);
        priceSteps.push(sell);
      }
      if (direction === 'long') priceSteps.reverse();

      for (let sell of priceSteps) {
        const totalBuy = buy * shares;
        const totalSell = sell * shares;
        const tax = Math.floor(totalSell * taxRate);
        const fee = Math.max(minFee, Math.floor((totalBuy + totalSell) * 0.001425 * feeRate));
        const profit = direction === 'long'
          ? (totalSell - totalBuy - tax - fee)
          : (totalBuy - totalSell - tax - fee);
        const returnRate = (profit / totalBuy * 100).toFixed(2);

        const row = document.createElement('tr');
        row.innerHTML = `
          <td class="p-2">${buy}</td>
          <td class="p-2">${sell}</td>
          <td class="p-2">${tax}</td>
          <td class="p-2">${fee}</td>
          <td class="p-2 ${profit >= 0 ? 'text-green-600' : 'text-red-600'}">${profit}</td>
          <td class="p-2 ${profit >= 0 ? 'text-green-600' : 'text-red-600'}">${returnRate}%</td>
        `;
        result.appendChild(row);
      }
    }

    renderCalculator("intraday");
  </script>
</body>
</html>
